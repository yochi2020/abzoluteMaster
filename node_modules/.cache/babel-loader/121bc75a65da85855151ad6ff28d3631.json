{"ast":null,"code":"var _jsxFileName = \"/Users/chanaphatsuzuki/Desktop/programming/abzolute/src/page/user/Userleave.js\";\nimport React, { useEffect, useState, useRef } from 'react';\nimport Footer from '../../component/admin/Footer';\nimport Navbar from '../../component/admin/Navbar';\nimport Sidebar from '../../component/user/Sidebar';\nimport Checkuser from './Checkuser';\nimport Form from './Userleave/Form';\nimport { auth, firestore } from '../../firebase/config';\nimport $ from 'jquery';\nimport { MDBDataTableV5 } from 'mdbreact';\n\nconst Userleave = () => {\n  const [allData, setAllData] = useState([]);\n  const [leaveOfUser, setleaveOfUser] = useState([]);\n  const [appove, setAppove] = useState([]);\n  const [typeLeave, setTypeLeave] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const refAppove = useRef(firestore.collection(\"appove\")).current;\n  const refLeave = firestore.collection(\"leave\");\n  const refTypeLeave = firestore.collection(\"type_leave\");\n  const [datatable, setDatatable] = React.useState({\n    columns: [{\n      label: 'วันที่แจ้ง',\n      field: 'leave_date',\n      width: 150,\n      attributes: {\n        'aria-controls': 'DataTable',\n        'aria-label': 'Name'\n      }\n    }, {\n      label: 'วันที่ลา',\n      field: 'leave_start',\n      width: 270\n    }, {\n      label: 'จำนวนวัน',\n      field: 'amount',\n      width: 200\n    }, {\n      label: 'ประเภทการลา',\n      field: 'type_leave_name',\n      sort: 'asc',\n      width: 100\n    }, {\n      label: 'หมายเหตุ',\n      field: 'reson',\n      sort: 'disabled',\n      width: 150\n    }, {\n      label: 'สถานะ',\n      field: 'status',\n      sort: 'disabled',\n      width: 100\n    }, {\n      label: 'จัดการ',\n      field: 'config',\n      sort: 'disabled',\n      width: 100\n    }]\n  });\n  console.log(1);\n  useEffect(() => {\n    console.log(2);\n    const unSubscribeLeaveOfUser = auth.onAuthStateChanged(firebase => {\n      if (!!firebase) {\n        const ref_leave = firestore.collection(\"leave\").where(\"uid\", \"==\", firebase.uid);\n        ref_leave.onSnapshot(doc_leave => {\n          let tempDataArray_leave = [];\n          doc_leave.forEach(data_leave => {\n            tempDataArray_leave = [...tempDataArray_leave, {\n              leave_date: data_leave.data().leave_date,\n              leave_start: data_leave.data().leave_start,\n              reson: data_leave.data().reson,\n              type_leave_id: data_leave.data().type_leave_id,\n              amount: data_leave.data().amount,\n              leave_id: data_leave.id,\n              uid: data_leave.data().uid\n            }];\n          });\n          setleaveOfUser(() => tempDataArray_leave);\n          setLoading(false);\n        });\n      }\n    });\n    const unSubscribeAppove = refAppove.onSnapshot(doc => {\n      let tempArrayAppove = [];\n      doc.forEach(data => {\n        tempArrayAppove = [...tempArrayAppove, {\n          appoveId: data.id,\n          hr_appove: data.data().hr_appove,\n          hr_remark: data.data().hr_remark,\n          leave_appove: data.data().leave_appove,\n          leave_remark: data.data().leave_remark,\n          leave_id: data.data().leave_id,\n          status: data.data().status\n        }];\n      });\n      setAppove(() => tempArrayAppove);\n    });\n    const unSubscribeTypeLeave = refTypeLeave.onSnapshot(doc => {\n      let tempArrayTypeLeave = [];\n      doc.forEach(data => {\n        tempArrayTypeLeave = [...tempArrayTypeLeave, {\n          type_leave_id: data.id,\n          type_leave_name: data.data().type_leave_name\n        }];\n      });\n      setTypeLeave(() => tempArrayTypeLeave);\n    });\n    reload();\n    return () => {\n      unSubscribeLeaveOfUser();\n      unSubscribeAppove();\n      unSubscribeTypeLeave();\n    };\n  }, [loading]);\n  console.log(3);\n\n  const reload = () => {\n    let tempArrayFindData = leaveOfUser;\n    tempArrayFindData.forEach((data, i) => {\n      typeLeave.forEach(dataTypeLeave => {\n        if (dataTypeLeave.type_leave_id === data.type_leave_id) {\n          tempArrayFindData[i] = { ...tempArrayFindData[i],\n            type_leave_name: dataTypeLeave.type_leave_name\n          };\n        }\n      });\n      appove.forEach(dataAppove => {\n        if (dataAppove.leave_id === data.leave_id) {\n          let buttotDelete = /*#__PURE__*/React.createElement(\"div\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 155,\n              columnNumber: 29\n            }\n          }, /*#__PURE__*/React.createElement(\"button\", {\n            type: \"button\",\n            id: dataAppove.appoveId,\n            name: data.leave_id,\n            className: \"btn btn-sm btn-outline-success\",\n            \"data-bs-toggle\": \"modal\",\n            \"data-bs-target\": \"#staticBackdrop\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 155,\n              columnNumber: 34\n            }\n          }, \"Edit\"), \" \", /*#__PURE__*/React.createElement(\"button\", {\n            onClick: e => {\n              deleteHandle(e);\n            },\n            className: \"btn btn-sm btn-outline-danger\",\n            id: dataAppove.appoveId,\n            name: data.leave_id,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 155,\n              columnNumber: 215\n            }\n          }, \"Delete\"));\n          let status = '';\n\n          switch (dataAppove.status) {\n            case 'y':\n              status = 'อนุมัติ';\n              break;\n\n            case 'no':\n              status = 'ไม่อนุมัติ';\n              break;\n\n            case '':\n              status = 'รออนุมัติ';\n          }\n\n          if (dataAppove.status != '') {\n            tempArrayFindData[i] = '';\n          } else {\n            tempArrayFindData[i] = { ...tempArrayFindData[i],\n              status: /*#__PURE__*/React.createElement(\"span\", {\n                className: \"badge badge-pill badge-dark\",\n                __self: this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 171,\n                  columnNumber: 22\n                }\n              }, status),\n              config: buttotDelete\n            };\n          }\n        }\n      });\n    });\n    setDatatable({ ...datatable,\n      rows: tempArrayFindData\n    });\n  };\n\n  const deleteHandle = e => {\n    setLoading(true);\n    const leaveId = e.target.name;\n    const appoveId = e.target.id;\n    refLeave.doc(leaveId).delete();\n    refAppove.doc(appoveId).delete();\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Checkuser, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Navbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Sidebar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-lg-12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-header \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex justify-content-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"m-0 text-dark\",\n    onClick: () => {\n      console.log();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 23\n    }\n  }, \"\\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\\u0E02\\u0E2D\\u0E25\\u0E32\"), /*#__PURE__*/React.createElement(Form, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 23\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-body table-responsive \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    class: \"btn btn-primary\",\n    \"data-bs-toggle\": \"modal\",\n    \"data-bs-target\": \"#staticBackdrop\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 19\n    }\n  }, \"Launch static backdrop modal\"), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"modal fade\",\n    id: \"staticBackdrop\",\n    \"data-bs-backdrop\": \"static\",\n    \"data-bs-keyboard\": \"false\",\n    tabindex: \"-1\",\n    \"aria-labelledby\": \"staticBackdropLabel\",\n    \"aria-hidden\": \"true\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 1\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    class: \"modal-dialog\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    class: \"modal-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    class: \"modal-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h5\", {\n    class: \"modal-title\",\n    id: \"staticBackdropLabel\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 9\n    }\n  }, \"Modal title\"), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    class: \"btn-close\",\n    \"data-bs-dismiss\": \"modal\",\n    \"aria-label\": \"Close\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"modal-body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }\n  }, \"...\"), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"modal-footer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    class: \"btn btn-secondary\",\n    \"data-bs-dismiss\": \"modal\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 9\n    }\n  }, \"Close\"), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    class: \"btn btn-primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 9\n    }\n  }, \"Understood\"))))), loading ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"spinner-border mx-auto\",\n    style: {\n      width: \"3rem\",\n      height: \"3rem\"\n    },\n    role: \"status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 29\n    }\n  }) : /*#__PURE__*/React.createElement(MDBDataTableV5, {\n    data: datatable,\n    entriesOptions: [5, 20, 25],\n    entries: 5,\n    pagesAmount: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 26\n    }\n  })))))))), /*#__PURE__*/React.createElement(\"aside\", {\n    className: \"control-sidebar control-sidebar-dark\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default Userleave;","map":{"version":3,"sources":["/Users/chanaphatsuzuki/Desktop/programming/abzolute/src/page/user/Userleave.js"],"names":["React","useEffect","useState","useRef","Footer","Navbar","Sidebar","Checkuser","Form","auth","firestore","$","MDBDataTableV5","Userleave","allData","setAllData","leaveOfUser","setleaveOfUser","appove","setAppove","typeLeave","setTypeLeave","loading","setLoading","refAppove","collection","current","refLeave","refTypeLeave","datatable","setDatatable","columns","label","field","width","attributes","sort","console","log","unSubscribeLeaveOfUser","onAuthStateChanged","firebase","ref_leave","where","uid","onSnapshot","doc_leave","tempDataArray_leave","forEach","data_leave","leave_date","data","leave_start","reson","type_leave_id","amount","leave_id","id","unSubscribeAppove","doc","tempArrayAppove","appoveId","hr_appove","hr_remark","leave_appove","leave_remark","status","unSubscribeTypeLeave","tempArrayTypeLeave","type_leave_name","reload","tempArrayFindData","i","dataTypeLeave","dataAppove","buttotDelete","e","deleteHandle","config","rows","leaveId","target","name","delete","height"],"mappings":"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","sourcesContent":["import React, { useEffect, useState,useRef } from 'react';\nimport Footer from '../../component/admin/Footer';\nimport Navbar from '../../component/admin/Navbar';\nimport Sidebar from '../../component/user/Sidebar';\nimport Checkuser from './Checkuser';\nimport Form from './Userleave/Form';\nimport { auth, firestore } from '../../firebase/config'\nimport $ from 'jquery'\nimport {MDBDataTableV5} from 'mdbreact'\nconst Userleave = () => {\n  const [allData,setAllData]=useState([])\n  const [leaveOfUser, setleaveOfUser] = useState([]) \n  const [appove,setAppove]=useState([])\n  const [typeLeave,setTypeLeave]=useState([])\n  const [loading, setLoading] = useState(true)\n\n\n  const refAppove = useRef(firestore.collection(\"appove\")).current\n  const refLeave = firestore.collection(\"leave\")\n  const refTypeLeave = firestore.collection(\"type_leave\")\n\n  const [datatable, setDatatable] = React.useState({\n    columns: [\n      {\n        label: 'วันที่แจ้ง',\n        field: 'leave_date',\n        width: 150,\n        attributes: {\n          'aria-controls': 'DataTable',\n          'aria-label': 'Name',\n        },\n      },\n      {\n        label: 'วันที่ลา',\n        field: 'leave_start',\n        width: 270,\n      },\n      {\n        label: 'จำนวนวัน',\n        field: 'amount',\n        width: 200,\n      },\n      {\n        label: 'ประเภทการลา',\n        field: 'type_leave_name',\n        sort: 'asc',\n        width: 100,\n      },\n      {\n        label: 'หมายเหตุ',\n        field: 'reson',\n        sort: 'disabled',\n        width: 150,\n      },\n      {\n        label: 'สถานะ',\n        field: 'status',\n        sort: 'disabled',\n        width: 100,\n      },\n      {\n        label: 'จัดการ',\n        field: 'config',\n        sort: 'disabled',\n        width: 100,\n      }\n    ],})\nconsole.log(1)\n  useEffect(() => {\n    console.log(2)\n\n    const unSubscribeLeaveOfUser = auth.onAuthStateChanged((firebase) => {\n      if (!!firebase) {\n        const ref_leave = firestore.collection(\"leave\").where(\"uid\", \"==\", firebase.uid)\n        ref_leave.onSnapshot(doc_leave => {\n          let tempDataArray_leave = [];\n          doc_leave.forEach(data_leave => {\n            tempDataArray_leave = [\n              ...tempDataArray_leave,\n              {\n              leave_date:data_leave.data().leave_date,\n              leave_start:data_leave.data().leave_start,\n              reson:data_leave.data().reson,\n              type_leave_id:data_leave.data().type_leave_id,\n              amount:data_leave.data().amount,\n              leave_id:data_leave.id,\n              uid:data_leave.data().uid\n              }\n            ]\n          })\n          setleaveOfUser(()=>tempDataArray_leave)\n          setLoading(false)\n\n        })\n      }\n    })\n\n    const unSubscribeAppove = refAppove.onSnapshot(doc=>{\n      let tempArrayAppove = []\n      doc.forEach(data=>{\n        tempArrayAppove=[\n          ...tempArrayAppove,\n          {\n            appoveId:data.id,\n            hr_appove:data.data().hr_appove,\n            hr_remark:data.data().hr_remark,\n            leave_appove:data.data().leave_appove,\n            leave_remark:data.data().leave_remark,\n            leave_id:data.data().leave_id,\n            status:data.data().status\n          }\n        ]\n      })\n      setAppove(()=>tempArrayAppove)\n    })\n\n    const unSubscribeTypeLeave = refTypeLeave.onSnapshot(doc=>{\n      let tempArrayTypeLeave = []\n      doc.forEach(data=>{\n        tempArrayTypeLeave=[\n          ...tempArrayTypeLeave,\n          {\n            type_leave_id:data.id,\n            type_leave_name:data.data().type_leave_name\n          }\n        ]\n      })\n      setTypeLeave(()=>tempArrayTypeLeave)\n    })\n\n    reload()\n    \n    return () => {\n      unSubscribeLeaveOfUser()\n      unSubscribeAppove()\n      unSubscribeTypeLeave()\n    }\n  },[loading])\n  \n  console.log(3)\n  const reload =()=>{\n    let tempArrayFindData = leaveOfUser\n    tempArrayFindData.forEach((data,i)=>{\n      typeLeave.forEach(dataTypeLeave=>{\n        if(dataTypeLeave.type_leave_id===data.type_leave_id){\n          tempArrayFindData[i]={\n            ...tempArrayFindData[i],\n            type_leave_name:dataTypeLeave.type_leave_name,\n          }\n        }\n      })\n\n      appove.forEach(dataAppove=>{\n        if(dataAppove.leave_id===data.leave_id){\n          let buttotDelete =<div><button type=\"button\" id={dataAppove.appoveId} name={data.leave_id} className=\"btn btn-sm btn-outline-success\" data-bs-toggle=\"modal\" data-bs-target=\"#staticBackdrop\">Edit</button> <button onClick={(e)=>{deleteHandle(e)}} className=\"btn btn-sm btn-outline-danger\" id={dataAppove.appoveId} name={data.leave_id}>Delete</button></div>\n\n          let status=''\n          switch (dataAppove.status) {\n            case 'y': status='อนุมัติ'\n            break;\n            case 'no': status='ไม่อนุมัติ'\n            break;\n            case '':  status='รออนุมัติ'\n            \n          }\n          if(dataAppove.status!=''){\n            tempArrayFindData[i]=''\n          }else{\n            tempArrayFindData[i]={\n              ...tempArrayFindData[i],\n              status:<span className=\"badge badge-pill badge-dark\">{status}</span>,\n              config:buttotDelete\n\n            }\n          }\n          \n        }\n      })\n    })\n\n\n    setDatatable({...datatable,rows:tempArrayFindData})\n  }\n\n  const deleteHandle = (e)=>{\n    setLoading(true)\n    const leaveId =  e.target.name\n    const appoveId=  e.target.id\n     refLeave.doc(leaveId).delete()\n     refAppove.doc(appoveId).delete()\n\n    \n  }\n  return (\n    <div>\n      <Checkuser />\n      <Navbar />\n      <Sidebar />\n      {/* Content Wrapper. Contains page content */}\n      <div className=\"content-wrapper\">\n        {/* Content Header (Page header) */}\n        <div className=\"content-header\">\n          <div className=\"container-fluid\">\n            <div className=\"row mb-2\">\n            </div>{/* /.row */}\n          </div>{/* /.container-fluid */}\n        </div>\n        {/* /.content-header */}\n        {/* Main content */}\n        <div className=\"content\">\n          <div className=\"container-fluid\">\n            <div className=\"row\">\n              <div className=\"col-lg-12\">\n                <div className=\"card\">\n                  <div className=\"card-header \">\n                    <div className=\"d-flex justify-content-between\">\n                      <h3 className=\"m-0 text-dark\" onClick={()=>{console.log()}}>รายการขอลา</h3>\n                      <Form />\n                    </div>\n                  </div>\n                  <div className=\"card-body table-responsive \">\n                  <button type=\"button\" class=\"btn btn-primary\" data-bs-toggle=\"modal\" data-bs-target=\"#staticBackdrop\">\n  Launch static backdrop modal\n</button>\n\n<div class=\"modal fade\" id=\"staticBackdrop\" data-bs-backdrop=\"static\" data-bs-keyboard=\"false\" tabindex=\"-1\" aria-labelledby=\"staticBackdropLabel\" aria-hidden=\"true\">\n  <div class=\"modal-dialog\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h5 class=\"modal-title\" id=\"staticBackdropLabel\">Modal title</h5>\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n      </div>\n      <div class=\"modal-body\">\n        ...\n      </div>\n      <div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Close</button>\n        <button type=\"button\" class=\"btn btn-primary\">Understood</button>\n      </div>\n    </div>\n  </div>\n</div>\n                  {\n                        loading ?(\n                            <div className=\"spinner-border mx-auto\" style={{width:\"3rem\",height:\"3rem\"}} role=\"status\">\n                            </div>\n                         \n                        )\n                        :<MDBDataTableV5 data={datatable} entriesOptions={[5, 20, 25]} entries={5} pagesAmount={4}/>\n\n                  }\n                  </div>\n                </div>\n              </div>\n              {/* /.col-md-6 */}\n              {/* /.col-md-6 */}\n            </div>\n            {/* /.row */}\n          </div>\n          {/* /.container-fluid */}\n        </div>\n        {/* /.content */}\n      </div>\n      {/* /.content-wrapper */}\n      {/* Control Sidebar */}\n      <aside className=\"control-sidebar control-sidebar-dark\">\n        {/* Control sidebar content goes here */}\n      </aside>\n      {/* /.control-sidebar */}\n      <Footer />\n    </div >\n  );\n};\n\nexport default Userleave;"]},"metadata":{},"sourceType":"module"}