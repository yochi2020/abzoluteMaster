{"ast":null,"code":"var _jsxFileName = \"/Users/chanaphatsuzuki/Desktop/programming/abzolute/src/page/admin/Leavelist.js\";\nimport React, { useState, useEffect } from 'react';\nimport Navbar from '../../component/admin/Navbar';\nimport Sidebar from '../../component/admin/Sidebar';\nimport Footer from '../../component/admin/Footer';\nimport Checkadmin from './Checkadmin';\nimport { firestore, auth } from '../../firebase/config';\nimport { MDBDataTableV5 } from 'mdbreact';\nimport axios from 'axios';\nexport default function Leavelist() {\n  const [reasonDelete, setReasonDelete] = useState(\"ddd\"); //เห็นผลที่ไม่ให้ลา (ใช้คำว่าdeleteแทน)\n\n  const [loading, setLoading] = useState(true);\n  const [user, setUser] = useState([]);\n  const [appove, setAppove] = useState([]);\n  const [leave, setLeave] = useState([]);\n  const [typeLeave, setTypeLeave] = useState([]);\n  const [quota, setQuota] = useState([]);\n  const refUser = firestore.collection('user');\n  const refAppove = firestore.collection('appove');\n  const refLeave = firestore.collection(\"leave\");\n  const refTypeLeave = firestore.collection(\"type_leave\");\n  const refQuota = firestore.collection(\"quota\");\n  const [datatable, setDatatable] = useState({\n    columns: [{\n      label: 'ชื่อพนักงาน',\n      field: 'name',\n      width: 200\n    }, {\n      label: 'วันที่แจ้ง',\n      field: 'leave_date',\n      width: 200\n    }, {\n      label: 'วันที่ลา',\n      field: 'leave_start',\n      width: 200\n    }, {\n      label: 'จำนวนวัน',\n      field: 'amount',\n      sort: 'asc',\n      width: 2\n    }, {\n      label: 'ประเภทการลา',\n      field: 'type_leave_name',\n      sort: 'asc'\n    }, {\n      label: 'เหตุผลที่ลา',\n      field: 'reason',\n      sort: 'asc'\n    }, {\n      label: 'สถานะ',\n      field: 'status2',\n      sort: 'disabled'\n    }, {\n      label: 'จัดการ',\n      field: 'control',\n      sort: 'disabled'\n    }]\n  });\n  useEffect(() => {\n    const usersubscribe = refUser.onSnapshot(doc => {\n      let tempArrayUser = [];\n      doc.forEach(data => {\n        tempArrayUser = [...tempArrayUser, {\n          uid: data.id,\n          fname: data.data().fname,\n          lname: data.data().lname,\n          name: data.data().name,\n          phone: data.data().phone,\n          user_group: data.data().user_group\n        }];\n      });\n      setUser(tempArrayUser);\n    });\n    const appovesubscribe = refAppove.onSnapshot(doc => {\n      let tempArrayAppove = [];\n      doc.forEach(data => {\n        tempArrayAppove = [...tempArrayAppove, {\n          appoveId: data.id,\n          hr_appove: data.data().hr_appove,\n          hr_remark: data.data().hr_remark,\n          leave_appove: data.data().leave_appove,\n          leave_remark: data.data().leave_remark,\n          leave_id: data.data().leave_id,\n          status: data.data().status\n        }];\n      });\n      setAppove(tempArrayAppove);\n    });\n    const leavesubscribe = refLeave.onSnapshot(doc => {\n      let tempArrayLeave = [];\n      doc.forEach(data => {\n        tempArrayLeave = [...tempArrayLeave, {\n          leaveId: data.id,\n          leave_date: data.data().leave_date,\n          leave_start: data.data().leave_start,\n          reason: data.data().reson,\n          type_leave_id: data.data().type_leave_id,\n          uid: data.data().uid,\n          amount: data.data().amount\n        }];\n      });\n      setLeave(tempArrayLeave);\n    });\n    const typeleavesubscribe = refTypeLeave.onSnapshot(doc => {\n      let tempArrayTypeLeave = [];\n      doc.forEach(data => {\n        tempArrayTypeLeave = [...tempArrayTypeLeave, {\n          typeLeaveId: data.id,\n          type_leave_name: data.data().type_leave_name\n        }];\n      });\n      setTypeLeave(tempArrayTypeLeave);\n    });\n    const quotasubscribe = refQuota.onSnapshot(doc => {\n      let tempArrayQuota = [];\n      doc.forEach(data => {\n        tempArrayQuota = [...tempArrayQuota, {\n          quotaId: data.id,\n          amount: data.data().amount,\n          type_leave_id: data.data().type_leave_id,\n          uid: data.data().uid\n        }];\n      });\n      setQuota(tempArrayQuota);\n      setLoading(false);\n    });\n    reLoad();\n    return () => {\n      usersubscribe();\n      appovesubscribe();\n      leavesubscribe();\n      typeleavesubscribe();\n      quotasubscribe();\n    };\n  }, [loading]);\n\n  const reLoad = () => {\n    let dataAll = leave;\n    dataAll.forEach((dataLeave, i) => {\n      let deleteName = '';\n      let deleteFname = '';\n      let deleteLname = '';\n      user.forEach(dataUser => {\n        if (dataLeave.uid === dataUser.uid) {\n          dataAll[i] = { ...dataAll[i],\n            ...dataUser\n          };\n          deleteName = dataUser.name;\n          deleteFname = dataUser.fname;\n          deleteLname = dataUser.lname;\n        }\n      });\n      typeLeave.forEach(dataTypeLeave => {\n        if (dataLeave.type_leave_id === dataTypeLeave.typeLeaveId) {\n          dataAll[i] = { ...dataAll[i],\n            type_leave_name: dataTypeLeave.type_leave_name\n          };\n        }\n      });\n      appove.forEach(dataAppove => {\n        let status = '';\n\n        if (dataLeave.leaveId === dataAppove.leave_id) {\n          console.log(dataAppove);\n\n          if (dataAppove.status === \"\") {\n            status = 'รออนุมัติ';\n\n            if (dataAppove.hr_appove != '') {\n              status = 'รอหัวหน้าอนุมัติ';\n            }\n\n            if (dataAppove.leave_appove != '') {\n              status = 'รอhrอนุมัติ';\n            }\n          } else {\n            status = 'success'; // อนุมัติหรือไม่อนุมัติแล้ว\n          }\n\n          dataAll[i] = { ...dataAll[i],\n            status: status,\n            status2: /*#__PURE__*/React.createElement(\"span\", {\n              className: \"badge badge-pill badge-dark\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 216,\n                columnNumber: 22\n              }\n            }, status),\n            control: /*#__PURE__*/React.createElement(\"div\", {\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 217,\n                columnNumber: 22\n              }\n            }, /*#__PURE__*/React.createElement(\"button\", {\n              className: \"btn btn-sm btn-outline-success mr-3\",\n              onClick: () => {\n                appoveHandle(dataAppove, dataLeave.reason, deleteFname, deleteLname, deleteName);\n              },\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 218,\n                columnNumber: 15\n              }\n            }, \"\\u0E2D\\u0E19\\u0E38\\u0E21\\u0E31\\u0E15\\u0E34\"), /*#__PURE__*/React.createElement(\"button\", {\n              className: \"btn btn-sm btn-outline-danger\",\n              \"data-toggle\": \"modal\",\n              \"data-target\": \"#exampleModal\",\n              onClick: () => {\n                clickDeleteHandle(dataAppove, dataLeave.reason, deleteFname, deleteLname, deleteName);\n              },\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 221,\n                columnNumber: 15\n              }\n            }, \"\\u0E44\\u0E21\\u0E48\\u0E2D\\u0E19\\u0E38\\u0E21\\u0E31\\u0E15\\u0E34\"), /*#__PURE__*/React.createElement(\"div\", {\n              className: \"modal fade\",\n              id: \"exampleModal\",\n              tabIndex: -1,\n              \"aria-labelledby\": \"exampleModalLabel\",\n              \"aria-hidden\": \"true\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 224,\n                columnNumber: 15\n              }\n            }, /*#__PURE__*/React.createElement(\"div\", {\n              className: \"modal-dialog\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 225,\n                columnNumber: 17\n              }\n            }, /*#__PURE__*/React.createElement(\"div\", {\n              className: \"modal-content\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 226,\n                columnNumber: 19\n              }\n            }, /*#__PURE__*/React.createElement(\"div\", {\n              className: \"modal-header\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 227,\n                columnNumber: 21\n              }\n            }, /*#__PURE__*/React.createElement(\"h5\", {\n              className: \"modal-title\",\n              id: \"exampleModalLabel\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 228,\n                columnNumber: 23\n              }\n            }, \"\\u0E40\\u0E2B\\u0E15\\u0E38\\u0E1C\\u0E25\"), /*#__PURE__*/React.createElement(\"button\", {\n              type: \"button\",\n              className: \"close\",\n              \"data-dismiss\": \"modal\",\n              \"aria-label\": \"Close\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 229,\n                columnNumber: 23\n              }\n            }, /*#__PURE__*/React.createElement(\"span\", {\n              \"aria-hidden\": \"true\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 230,\n                columnNumber: 25\n              }\n            }, \"\\xD7\"))), /*#__PURE__*/React.createElement(\"div\", {\n              className: \"modal-body\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 233,\n                columnNumber: 21\n              }\n            }, /*#__PURE__*/React.createElement(\"input\", {\n              type: \"text\",\n              value: reasonDelete,\n              name: reasonDelete,\n              onChange: e => setReasonDelete(e.target.value),\n              className: \"form-control\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 234,\n                columnNumber: 23\n              }\n            })), /*#__PURE__*/React.createElement(\"div\", {\n              className: \"modal-footer\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 236,\n                columnNumber: 21\n              }\n            }, /*#__PURE__*/React.createElement(\"button\", {\n              type: \"button\",\n              className: \"btn btn-secondary\",\n              \"data-dismiss\": \"modal\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 237,\n                columnNumber: 23\n              }\n            }, \"\\u0E22\\u0E01\\u0E40\\u0E25\\u0E34\\u0E01\"), /*#__PURE__*/React.createElement(\"button\", {\n              type: \"button\",\n              className: \"btn btn-primary\",\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 238,\n                columnNumber: 23\n              }\n            }, \"\\u0E44\\u0E21\\u0E48\\u0E2D\\u0E19\\u0E38\\u0E21\\u0E31\\u0E15\\u0E34\"))))))\n          };\n        }\n      });\n    });\n    const filterNotYed = dataAll.filter(data => {\n      return data.status != 'success';\n    });\n    setDatatable({ ...datatable,\n      rows: filterNotYed\n    });\n  };\n\n  const deleteHandle = (appoveObj, reason, fname, lname, name) => {\n    setLoading(true);\n    const fullName = fname + \" \" + lname + \"(\" + name + \") \";\n    console.log(appoveObj);\n    refUser.doc(auth.currentUser.uid).onSnapshot(doc_user => {\n      if (doc_user.data().user_group === 'hr') {\n        refAppove.doc(appoveObj.appoveId).set({ ...appoveObj,\n          hr_appove: \"ไม่อนุมัติ\",\n          status: \"no\",\n          hr_remark: reason\n        });\n      } else if (doc_user.data().user_group === 'admin') {\n        refAppove.doc(appoveObj.appoveId).set({ ...appoveObj,\n          leave_appove: \"ไม่อนุมัติ\",\n          status: \"no\",\n          leave_remark: reason\n        });\n      }\n\n      axios.get(\"http://localhost:4000/allow/notallowed/\" + reason + \"/\" + fullName).then(() => {}).catch(err => console.log(err));\n    });\n  };\n\n  const appoveHandle = (obj, reason, fname, lname, name) => {\n    setLoading(true);\n    let fullName = fname + \" \" + lname + \" \" + \" (\" + name + \" )\";\n    const reson = reason;\n    refUser.doc(auth.currentUser.uid).onSnapshot(doc_user => {\n      if (doc_user.data().user_group === 'hr') {\n        refAppove.doc(obj.appoveId).set({ ...obj,\n          hr_appove: \"อนุมัติ\"\n        });\n\n        if (obj.leave_appove === 'อนุมัติ') {\n          refAppove.doc(obj.appoveId).set({ ...obj,\n            status: \"y\"\n          });\n          axios.get(\"http://localhost:4000/allow/allow/\" + reson + \"/\" + fullName).then(res => {\n            console.log(res);\n          }).catch(err => console.log(err));\n        }\n      } else if (doc_user.data().user_group === 'admin') {\n        refAppove.doc(obj.appoveId).set({ ...obj,\n          leave_appove: \"อนุมัติ\"\n        });\n\n        if (obj.hr_appove === 'อนุมัติ') {\n          refAppove.doc(obj.appoveId).set({ ...obj,\n            status: \"y\"\n          });\n          axios.get(\"http://localhost:4000/allow/allow/\" + reson + \"/\" + fullName).then(res => {\n            console.log(res);\n          }).catch(err => console.log(err));\n        }\n      }\n    });\n  };\n\n  const clickDeleteHandle = () => {};\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Checkadmin, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 313,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Navbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Checkadmin, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Sidebar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 329,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-lg-12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-header \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex justify-content-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 334,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"m-0 text-dark\",\n    onClick: () => {\n      console.log(datatable);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 23\n    }\n  }, \"\\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\\u0E25\\u0E32\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-body table-responsive \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 19\n    }\n  }, loading ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"spinner-border mx-auto\",\n    style: {\n      width: \"3rem\",\n      height: \"3rem\"\n    },\n    role: \"status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 25\n    }\n  }) : /*#__PURE__*/React.createElement(MDBDataTableV5, {\n    searchBottom: false,\n    hover: true,\n    entriesOptions: [5, 20, 25],\n    entries: 5,\n    pagesAmount: 4,\n    data: datatable,\n    searchTop: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 27\n    }\n  })))))))), /*#__PURE__*/React.createElement(\"aside\", {\n    className: \"control-sidebar control-sidebar-dark\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 359,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 7\n    }\n  }));\n}","map":{"version":3,"sources":["/Users/chanaphatsuzuki/Desktop/programming/abzolute/src/page/admin/Leavelist.js"],"names":["React","useState","useEffect","Navbar","Sidebar","Footer","Checkadmin","firestore","auth","MDBDataTableV5","axios","Leavelist","reasonDelete","setReasonDelete","loading","setLoading","user","setUser","appove","setAppove","leave","setLeave","typeLeave","setTypeLeave","quota","setQuota","refUser","collection","refAppove","refLeave","refTypeLeave","refQuota","datatable","setDatatable","columns","label","field","width","sort","usersubscribe","onSnapshot","doc","tempArrayUser","forEach","data","uid","id","fname","lname","name","phone","user_group","appovesubscribe","tempArrayAppove","appoveId","hr_appove","hr_remark","leave_appove","leave_remark","leave_id","status","leavesubscribe","tempArrayLeave","leaveId","leave_date","leave_start","reason","reson","type_leave_id","amount","typeleavesubscribe","tempArrayTypeLeave","typeLeaveId","type_leave_name","quotasubscribe","tempArrayQuota","quotaId","reLoad","dataAll","dataLeave","i","deleteName","deleteFname","deleteLname","dataUser","dataTypeLeave","dataAppove","console","log","status2","control","appoveHandle","clickDeleteHandle","e","target","value","filterNotYed","filter","rows","deleteHandle","appoveObj","fullName","currentUser","doc_user","set","get","then","catch","err","obj","res","height"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Navbar from '../../component/admin/Navbar'\nimport Sidebar from '../../component/admin/Sidebar'\nimport Footer from '../../component/admin/Footer'\nimport Checkadmin from './Checkadmin';\nimport { firestore, auth } from '../../firebase/config'\nimport { MDBDataTableV5 } from 'mdbreact'\nimport axios from 'axios'\nexport default function Leavelist() {\n  const [reasonDelete, setReasonDelete] = useState(\"ddd\")  //เห็นผลที่ไม่ให้ลา (ใช้คำว่าdeleteแทน)\n  const [loading, setLoading] = useState(true)\n  const [user, setUser] = useState([])\n  const [appove, setAppove] = useState([])\n  const [leave, setLeave] = useState([])\n  const [typeLeave, setTypeLeave] = useState([])\n  const [quota, setQuota] = useState([])\n  const refUser = firestore.collection('user')\n  const refAppove = firestore.collection('appove')\n  const refLeave = firestore.collection(\"leave\")\n  const refTypeLeave = firestore.collection(\"type_leave\")\n  const refQuota = firestore.collection(\"quota\")\n\n  const [datatable, setDatatable] = useState({\n    columns: [\n      {\n        label: 'ชื่อพนักงาน',\n        field: 'name',\n        width: 200,\n      },\n      {\n        label: 'วันที่แจ้ง',\n        field: 'leave_date',\n        width: 200,\n      },\n      {\n        label: 'วันที่ลา',\n        field: 'leave_start',\n        width: 200,\n      },\n      {\n        label: 'จำนวนวัน',\n        field: 'amount',\n        sort: 'asc',\n        width: 2,\n      },\n      {\n        label: 'ประเภทการลา',\n        field: 'type_leave_name',\n        sort: 'asc',\n      },\n      {\n        label: 'เหตุผลที่ลา',\n        field: 'reason',\n        sort: 'asc',\n      },\n      {\n        label: 'สถานะ',\n        field: 'status2',\n        sort: 'disabled',\n      },\n      {\n        label: 'จัดการ',\n        field: 'control',\n        sort: 'disabled',\n      }\n    ]\n  });\n  useEffect(() => {\n    const usersubscribe = refUser.onSnapshot(doc => {\n      let tempArrayUser = []\n      doc.forEach(data => {\n        tempArrayUser = [\n          ...tempArrayUser,\n          {\n            uid: data.id,\n            fname: data.data().fname,\n            lname: data.data().lname,\n            name: data.data().name,\n            phone: data.data().phone,\n            user_group: data.data().user_group\n          }\n        ]\n      })\n      setUser(tempArrayUser)\n    })\n\n    const appovesubscribe = refAppove.onSnapshot(doc => {\n      let tempArrayAppove = []\n      doc.forEach(data => {\n        tempArrayAppove = [\n          ...tempArrayAppove,\n          {\n            appoveId: data.id,\n            hr_appove: data.data().hr_appove,\n            hr_remark: data.data().hr_remark,\n            leave_appove: data.data().leave_appove,\n            leave_remark: data.data().leave_remark,\n            leave_id: data.data().leave_id,\n            status: data.data().status\n          }\n        ]\n      })\n      setAppove(tempArrayAppove)\n    })\n\n    const leavesubscribe = refLeave.onSnapshot(doc => {\n      let tempArrayLeave = []\n      doc.forEach(data => {\n        tempArrayLeave = [\n          ...tempArrayLeave,\n          {\n            leaveId: data.id,\n            leave_date: data.data().leave_date,\n            leave_start: data.data().leave_start,\n            reason: data.data().reson,\n            type_leave_id: data.data().type_leave_id,\n            uid: data.data().uid,\n            amount: data.data().amount\n          }\n        ]\n      })\n      setLeave(tempArrayLeave)\n    })\n\n\n    const typeleavesubscribe = refTypeLeave.onSnapshot(doc => {\n      let tempArrayTypeLeave = []\n      doc.forEach(data => {\n        tempArrayTypeLeave = [\n          ...tempArrayTypeLeave,\n          {\n            typeLeaveId: data.id,\n            type_leave_name: data.data().type_leave_name\n          }\n        ]\n      })\n      setTypeLeave(tempArrayTypeLeave)\n\n    })\n\n    const quotasubscribe = refQuota.onSnapshot(doc => {\n      let tempArrayQuota = []\n      doc.forEach(data => {\n        tempArrayQuota = [\n          ...tempArrayQuota,\n          {\n            quotaId: data.id,\n            amount: data.data().amount,\n            type_leave_id: data.data().type_leave_id,\n            uid: data.data().uid\n          }\n        ]\n      })\n      setQuota(tempArrayQuota)\n\n      setLoading(false)\n    })\n    reLoad()\n    return (() => {\n      usersubscribe()\n      appovesubscribe()\n      leavesubscribe()\n      typeleavesubscribe()\n      quotasubscribe()\n    })\n\n  }, [loading])\n\n\n  const reLoad = () => {\n    let dataAll = leave\n\n    dataAll.forEach((dataLeave, i) => {\n      let deleteName = ''\n      let deleteFname = ''\n      let deleteLname = ''\n\n      user.forEach(dataUser => {\n        if (dataLeave.uid === dataUser.uid) {\n          dataAll[i] = {\n            ...dataAll[i],\n            ...dataUser\n          }\n          deleteName = dataUser.name\n          deleteFname = dataUser.fname\n          deleteLname = dataUser.lname\n        }\n      })\n      typeLeave.forEach(dataTypeLeave => {\n        if (dataLeave.type_leave_id === dataTypeLeave.typeLeaveId) {\n          dataAll[i] = {\n            ...dataAll[i],\n            type_leave_name: dataTypeLeave.type_leave_name\n          }\n        }\n      })\n\n      appove.forEach(dataAppove => {\n        let status = ''\n        if (dataLeave.leaveId === dataAppove.leave_id) {\n          console.log(dataAppove)\n          if (dataAppove.status === \"\") {\n            status = 'รออนุมัติ'\n            if (dataAppove.hr_appove != '') {\n              status = 'รอหัวหน้าอนุมัติ'\n            }\n            if (dataAppove.leave_appove != '') {\n              status = 'รอhrอนุมัติ'\n            }\n          } else {\n            status = 'success' // อนุมัติหรือไม่อนุมัติแล้ว\n          }\n          dataAll[i] = {\n            ...dataAll[i],\n            status: status,\n            status2: <span className=\"badge badge-pill badge-dark\">{status}</span>,\n            control: <div>\n              <button className=\"btn btn-sm btn-outline-success mr-3\" onClick={() => { appoveHandle(dataAppove, dataLeave.reason, deleteFname, deleteLname, deleteName) }}>\n                อนุมัติ\n              </button>\n              <button className=\"btn btn-sm btn-outline-danger\" data-toggle=\"modal\" data-target=\"#exampleModal\" onClick={() => { clickDeleteHandle(dataAppove, dataLeave.reason, deleteFname, deleteLname, deleteName) }}>\n                ไม่อนุมัติ\n              </button>\n              <div className=\"modal fade\" id=\"exampleModal\" tabIndex={-1} aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n                <div className=\"modal-dialog\">\n                  <div className=\"modal-content\">\n                    <div className=\"modal-header\">\n                      <h5 className=\"modal-title\" id=\"exampleModalLabel\">เหตุผล</h5>\n                      <button type=\"button\" className=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                        <span aria-hidden=\"true\">×</span>\n                      </button>\n                    </div>\n                    <div className=\"modal-body\">\n                      <input type=\"text\" value={reasonDelete} name={reasonDelete} onChange={(e)=>setReasonDelete(e.target.value)}  className=\"form-control\"/>\n                    </div>\n                    <div className=\"modal-footer\">\n                      <button type=\"button\" className=\"btn btn-secondary\" data-dismiss=\"modal\">ยกเลิก</button>\n                      <button type=\"button\" className=\"btn btn-primary\">ไม่อนุมัติ</button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n            </div>\n          }\n\n\n\n\n        }\n      })\n    })\n\n    const filterNotYed = dataAll.filter(data => {\n      return data.status != 'success'\n    })\n    setDatatable({ ...datatable, rows: filterNotYed })\n  }\n\n\n\n  const deleteHandle = (appoveObj, reason, fname, lname, name) => {\n    setLoading(true)\n    const fullName = fname + \" \" + lname + \"(\" + name + \") \"\n    console.log(appoveObj)\n    refUser.doc(auth.currentUser.uid).onSnapshot(doc_user => {\n      if (doc_user.data().user_group === 'hr') {\n        refAppove.doc(appoveObj.appoveId).set({ ...appoveObj, hr_appove: \"ไม่อนุมัติ\", status: \"no\", hr_remark: reason })\n      } else if (doc_user.data().user_group === 'admin') {\n        refAppove.doc(appoveObj.appoveId).set({ ...appoveObj, leave_appove: \"ไม่อนุมัติ\", status: \"no\", leave_remark: reason })\n      }\n      axios.get(\"http://localhost:4000/allow/notallowed/\" + reason + \"/\" + fullName)\n        .then(() => {\n        }).catch(err => console.log(err))\n    })\n\n  }\n\n  const appoveHandle = (obj, reason, fname, lname, name) => {\n    setLoading(true)\n    let fullName = fname + \" \" + lname + \" \" + \" (\" + name + \" )\";\n    const reson = reason\n\n    refUser.doc(auth.currentUser.uid).onSnapshot(doc_user => {\n      if (doc_user.data().user_group === 'hr') {\n        refAppove.doc(obj.appoveId).set({ ...obj, hr_appove: \"อนุมัติ\" })\n        if (obj.leave_appove === 'อนุมัติ') {\n          refAppove.doc(obj.appoveId).set({ ...obj, status: \"y\" })\n          axios.get(\"http://localhost:4000/allow/allow/\" + reson + \"/\" + fullName)\n            .then((res) => {\n              console.log(res)\n            }).catch(err => console.log(err))\n        }\n      } else if (doc_user.data().user_group === 'admin') {\n        refAppove.doc(obj.appoveId).set({ ...obj, leave_appove: \"อนุมัติ\" })\n        if (obj.hr_appove === 'อนุมัติ') {\n          refAppove.doc(obj.appoveId).set({ ...obj, status: \"y\" })\n          axios.get(\"http://localhost:4000/allow/allow/\" + reson + \"/\" + fullName)\n            .then((res) => {\n              console.log(res)\n            }).catch(err => console.log(err))\n        }\n      }\n    })\n  }\n\n  const clickDeleteHandle = () => {\n\n  }\n\n  return (\n    <div>\n      <Checkadmin />\n      <Navbar />\n      <Checkadmin />\n      <Sidebar />\n      {/* Content Wrapper. Contains page content */}\n      <div className=\"content-wrapper\">\n        {/* Content Header (Page header) */}\n        <div className=\"content-header\">\n          <div className=\"container-fluid\">\n            <div className=\"row mb-2\">\n            </div>{/* /.row */}\n          </div>{/* /.container-fluid */}\n        </div>\n        {/* /.content-header */}\n        {/* Main content */}\n        <div className=\"content\">\n          <div className=\"container-fluid\">\n            <div className=\"row\">\n              <div className=\"col-lg-12\">\n                <div className=\"card\">\n                  <div className=\"card-header \">\n                    <div className=\"d-flex justify-content-between\">\n                      <h3 className=\"m-0 text-dark\" onClick={() => { console.log(datatable) }}>รายการลา</h3>\n                    </div>\n                  </div>\n                  <div className=\"card-body table-responsive \">\n                    {\n                      loading ? (\n                        <div className=\"spinner-border mx-auto\" style={{ width: \"3rem\", height: \"3rem\" }} role=\"status\"></div>\n                      )\n                        : <MDBDataTableV5 searchBottom={false} hover entriesOptions={[5, 20, 25]} entries={5} pagesAmount={4} data={datatable} searchTop ></MDBDataTableV5>\n                    }\n                  </div>\n                </div>\n              </div>\n              {/* /.col-md-6 */}\n              {/* /.col-md-6 */}\n            </div>\n            {/* /.row */}\n          </div>\n          {/* /.container-fluid */}\n        </div>\n        {/* /.content */}\n      </div>\n      {/* /.content-wrapper */}\n      {/* Control Sidebar */}\n      <aside className=\"control-sidebar control-sidebar-dark\">\n        {/* Control sidebar content goes here */}\n      </aside>\n      {/* /.control-sidebar */}\n      <Footer />\n    </div>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}