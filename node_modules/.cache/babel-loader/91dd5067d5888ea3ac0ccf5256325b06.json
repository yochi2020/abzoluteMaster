{"ast":null,"code":"var _jsxFileName = \"/Users/chanaphatsuzuki/Desktop/programming/abzolute/src/page/user/Userleave.js\";\nimport React, { useEffect, useState, useRef } from 'react';\nimport Footer from '../../component/admin/Footer';\nimport Navbar from '../../component/admin/Navbar';\nimport Sidebar from '../../component/user/Sidebar';\nimport Checkuser from './Checkuser';\nimport Form from './Userleave/Form';\nimport { auth, firestore } from '../../firebase/config';\nimport $ from 'jquery';\nimport { MDBDataTableV5 } from 'mdbreact';\n\nconst Userleave = () => {\n  const [userEdit, setUserEdit] = useState({});\n  const [leaveOfUser, setleaveOfUser] = useState([]);\n  const [appove, setAppove] = useState([]);\n  const [typeLeave, setTypeLeave] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const refAppove = useRef(firestore.collection(\"appove\")).current;\n  const refLeave = firestore.collection(\"leave\");\n  const refTypeLeave = firestore.collection(\"type_leave\");\n  const [datatable, setDatatable] = React.useState({\n    columns: [{\n      label: 'วันที่แจ้ง',\n      field: 'leave_date',\n      width: 150,\n      attributes: {\n        'aria-controls': 'DataTable',\n        'aria-label': 'Name'\n      }\n    }, {\n      label: 'วันที่ลา',\n      field: 'leave_start',\n      width: 270\n    }, {\n      label: 'จำนวนวัน',\n      field: 'amount',\n      width: 200\n    }, {\n      label: 'ประเภทการลา',\n      field: 'type_leave_name',\n      sort: 'asc',\n      width: 100\n    }, {\n      label: 'หมายเหตุ',\n      field: 'reson',\n      sort: 'disabled',\n      width: 150\n    }, {\n      label: 'สถานะ',\n      field: 'status',\n      sort: 'disabled',\n      width: 100\n    }, {\n      label: 'จัดการ',\n      field: 'config',\n      sort: 'disabled',\n      width: 100\n    }]\n  });\n  console.log(1);\n  useEffect(() => {\n    console.log(2);\n    const unSubscribeLeaveOfUser = auth.onAuthStateChanged(firebase => {\n      if (!!firebase) {\n        const ref_leave = firestore.collection(\"leave\").where(\"uid\", \"==\", firebase.uid);\n        ref_leave.onSnapshot(doc_leave => {\n          let tempDataArray_leave = [];\n          doc_leave.forEach(data_leave => {\n            tempDataArray_leave = [...tempDataArray_leave, {\n              leave_date: data_leave.data().leave_date,\n              leave_start: data_leave.data().leave_start,\n              reson: data_leave.data().reson,\n              type_leave_id: data_leave.data().type_leave_id,\n              amount: data_leave.data().amount,\n              leave_id: data_leave.id,\n              uid: data_leave.data().uid\n            }];\n          });\n          setleaveOfUser(() => tempDataArray_leave);\n          setLoading(false);\n        });\n      }\n    });\n    const unSubscribeAppove = refAppove.onSnapshot(doc => {\n      let tempArrayAppove = [];\n      doc.forEach(data => {\n        tempArrayAppove = [...tempArrayAppove, {\n          appoveId: data.id,\n          hr_appove: data.data().hr_appove,\n          hr_remark: data.data().hr_remark,\n          leave_appove: data.data().leave_appove,\n          leave_remark: data.data().leave_remark,\n          leave_id: data.data().leave_id,\n          status: data.data().status\n        }];\n      });\n      setAppove(() => tempArrayAppove);\n    });\n    const unSubscribeTypeLeave = refTypeLeave.onSnapshot(doc => {\n      let tempArrayTypeLeave = [];\n      doc.forEach(data => {\n        tempArrayTypeLeave = [...tempArrayTypeLeave, {\n          type_leave_id: data.id,\n          type_leave_name: data.data().type_leave_name\n        }];\n      });\n      setTypeLeave(() => tempArrayTypeLeave);\n    });\n    reload();\n    return () => {\n      unSubscribeLeaveOfUser();\n      unSubscribeAppove();\n      unSubscribeTypeLeave();\n    };\n  }, [loading]);\n  console.log(3);\n\n  const reload = () => {\n    let tempArrayFindData = leaveOfUser;\n    tempArrayFindData.forEach((data, i) => {\n      typeLeave.forEach(dataTypeLeave => {\n        if (dataTypeLeave.type_leave_id === data.type_leave_id) {\n          tempArrayFindData[i] = { ...tempArrayFindData[i],\n            type_leave_name: dataTypeLeave.type_leave_name\n          };\n        }\n      });\n      console.log(appove);\n      appove.forEach(dataAppove => {\n        console.log(\"eieieieiei\");\n\n        if (dataAppove.leave_id === data.leave_id) {\n          let buttotDelete = /*#__PURE__*/React.createElement(\"div\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 159,\n              columnNumber: 30\n            }\n          }, /*#__PURE__*/React.createElement(\"button\", {\n            onClick: e => {\n              deleteHandle(e);\n            },\n            className: \"btn btn-sm btn-outline-danger\",\n            id: dataAppove.appoveId,\n            name: data.leave_id,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 159,\n              columnNumber: 35\n            }\n          }, \"Delete\"));\n          let status = '';\n\n          switch (dataAppove.status) {\n            case 'y':\n              status = 'อนุมัติ';\n              break;\n\n            case 'no':\n              status = 'ไม่อนุมัติ';\n              break;\n\n            case '':\n              status = 'รออนุมัติ';\n          }\n\n          if (dataAppove.status != '') {\n            tempArrayFindData[i] = '';\n          } else {\n            tempArrayFindData[i] = { ...tempArrayFindData[i],\n              status: /*#__PURE__*/React.createElement(\"span\", {\n                className: \"badge badge-pill badge-dark\",\n                __self: this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 175,\n                  columnNumber: 23\n                }\n              }, status),\n              config: buttotDelete\n            };\n          }\n        }\n      });\n    });\n    setDatatable({ ...datatable,\n      rows: tempArrayFindData\n    });\n  };\n\n  const deleteHandle = e => {\n    setLoading(true);\n    const leaveId = e.target.name;\n    const appoveId = e.target.id;\n    refLeave.doc(leaveId).delete();\n    refAppove.doc(appoveId).delete();\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Checkuser, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Navbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Sidebar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-lg-12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-header \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex justify-content-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"m-0 text-dark\",\n    onClick: () => {\n      console.log();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 23\n    }\n  }, \"\\u0E23\\u0E32\\u0E22\\u0E01\\u0E32\\u0E23\\u0E02\\u0E2D\\u0E25\\u0E32\"), /*#__PURE__*/React.createElement(Form, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 23\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-body table-responsive \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 19\n    }\n  }, loading ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"spinner-border mx-auto\",\n    style: {\n      width: \"3rem\",\n      height: \"3rem\"\n    },\n    role: \"status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 25\n    }\n  }) : /*#__PURE__*/React.createElement(MDBDataTableV5, {\n    data: datatable,\n    entriesOptions: [5, 20, 25],\n    entries: 5,\n    pagesAmount: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 27\n    }\n  })))))))), /*#__PURE__*/React.createElement(\"aside\", {\n    className: \"control-sidebar control-sidebar-dark\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default Userleave;","map":{"version":3,"sources":["/Users/chanaphatsuzuki/Desktop/programming/abzolute/src/page/user/Userleave.js"],"names":["React","useEffect","useState","useRef","Footer","Navbar","Sidebar","Checkuser","Form","auth","firestore","$","MDBDataTableV5","Userleave","userEdit","setUserEdit","leaveOfUser","setleaveOfUser","appove","setAppove","typeLeave","setTypeLeave","loading","setLoading","refAppove","collection","current","refLeave","refTypeLeave","datatable","setDatatable","columns","label","field","width","attributes","sort","console","log","unSubscribeLeaveOfUser","onAuthStateChanged","firebase","ref_leave","where","uid","onSnapshot","doc_leave","tempDataArray_leave","forEach","data_leave","leave_date","data","leave_start","reson","type_leave_id","amount","leave_id","id","unSubscribeAppove","doc","tempArrayAppove","appoveId","hr_appove","hr_remark","leave_appove","leave_remark","status","unSubscribeTypeLeave","tempArrayTypeLeave","type_leave_name","reload","tempArrayFindData","i","dataTypeLeave","dataAppove","buttotDelete","e","deleteHandle","config","rows","leaveId","target","name","delete","height"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\nimport Footer from '../../component/admin/Footer';\nimport Navbar from '../../component/admin/Navbar';\nimport Sidebar from '../../component/user/Sidebar';\nimport Checkuser from './Checkuser';\nimport Form from './Userleave/Form';\nimport { auth, firestore } from '../../firebase/config'\nimport $ from 'jquery'\nimport { MDBDataTableV5 } from 'mdbreact'\nconst Userleave = () => {\n  const [userEdit, setUserEdit] = useState({\n    \n  })\n  const [leaveOfUser, setleaveOfUser] = useState([])\n  const [appove, setAppove] = useState([])\n  const [typeLeave, setTypeLeave] = useState([])\n  const [loading, setLoading] = useState(true)\n\n\n  const refAppove = useRef(firestore.collection(\"appove\")).current\n  const refLeave = firestore.collection(\"leave\")\n  const refTypeLeave = firestore.collection(\"type_leave\")\n\n  const [datatable, setDatatable] = React.useState({\n    columns: [\n      {\n        label: 'วันที่แจ้ง',\n        field: 'leave_date',\n        width: 150,\n        attributes: {\n          'aria-controls': 'DataTable',\n          'aria-label': 'Name',\n        },\n      },\n      {\n        label: 'วันที่ลา',\n        field: 'leave_start',\n        width: 270,\n      },\n      {\n        label: 'จำนวนวัน',\n        field: 'amount',\n        width: 200,\n      },\n      {\n        label: 'ประเภทการลา',\n        field: 'type_leave_name',\n        sort: 'asc',\n        width: 100,\n      },\n      {\n        label: 'หมายเหตุ',\n        field: 'reson',\n        sort: 'disabled',\n        width: 150,\n      },\n      {\n        label: 'สถานะ',\n        field: 'status',\n        sort: 'disabled',\n        width: 100,\n      },\n      {\n        label: 'จัดการ',\n        field: 'config',\n        sort: 'disabled',\n        width: 100,\n      }\n    ]\n  },)\n  console.log(1)\n  useEffect(() => {\n    console.log(2)\n\n    const unSubscribeLeaveOfUser = auth.onAuthStateChanged((firebase) => {\n      if (!!firebase) {\n        const ref_leave = firestore.collection(\"leave\").where(\"uid\", \"==\", firebase.uid)\n        ref_leave.onSnapshot(doc_leave => {\n          let tempDataArray_leave = [];\n          doc_leave.forEach(data_leave => {\n            tempDataArray_leave = [\n              ...tempDataArray_leave,\n              {\n                leave_date: data_leave.data().leave_date,\n                leave_start: data_leave.data().leave_start,\n                reson: data_leave.data().reson,\n                type_leave_id: data_leave.data().type_leave_id,\n                amount: data_leave.data().amount,\n                leave_id: data_leave.id,\n                uid: data_leave.data().uid\n              }\n            ]\n          })\n          setleaveOfUser(() => tempDataArray_leave)\n          setLoading(false)\n\n        })\n      }\n    })\n\n    const unSubscribeAppove = refAppove.onSnapshot(doc => {\n      let tempArrayAppove = []\n      doc.forEach(data => {\n        tempArrayAppove = [\n          ...tempArrayAppove,\n          {\n            appoveId: data.id,\n            hr_appove: data.data().hr_appove,\n            hr_remark: data.data().hr_remark,\n            leave_appove: data.data().leave_appove,\n            leave_remark: data.data().leave_remark,\n            leave_id: data.data().leave_id,\n            status: data.data().status\n          }\n        ]\n      })\n      setAppove(() => tempArrayAppove)\n    })\n\n    const unSubscribeTypeLeave = refTypeLeave.onSnapshot(doc => {\n      let tempArrayTypeLeave = []\n      doc.forEach(data => {\n        tempArrayTypeLeave = [\n          ...tempArrayTypeLeave,\n          {\n            type_leave_id: data.id,\n            type_leave_name: data.data().type_leave_name\n          }\n        ]\n      })\n      setTypeLeave(() => tempArrayTypeLeave)\n    })\n\n    reload()\n\n    return () => {\n      unSubscribeLeaveOfUser()\n      unSubscribeAppove()\n      unSubscribeTypeLeave()\n    }\n  }, [loading])\n\n  console.log(3)\n  const reload = () => {\n    let tempArrayFindData = leaveOfUser\n    tempArrayFindData.forEach((data, i) => {\n      typeLeave.forEach(dataTypeLeave => {\n        if (dataTypeLeave.type_leave_id === data.type_leave_id) {\n          tempArrayFindData[i] = {\n            ...tempArrayFindData[i],\n            type_leave_name: dataTypeLeave.type_leave_name,\n          }\n        }\n      })\n      console.log(appove)\n      appove.forEach(dataAppove => {\n        console.log(\"eieieieiei\")\n        if (dataAppove.leave_id === data.leave_id) {\n          let buttotDelete = <div><button onClick={(e) => { deleteHandle(e) }} className=\"btn btn-sm btn-outline-danger\" id={dataAppove.appoveId} name={data.leave_id}>Delete</button></div>\n\n          let status = ''\n          switch (dataAppove.status) {\n            case 'y': status = 'อนุมัติ'\n              break;\n            case 'no': status = 'ไม่อนุมัติ'\n              break;\n            case '': status = 'รออนุมัติ'\n\n          }\n          if (dataAppove.status != '') {\n            tempArrayFindData[i] = ''\n          } else {\n            tempArrayFindData[i] = {\n              ...tempArrayFindData[i],\n              status: <span className=\"badge badge-pill badge-dark\">{status}</span>,\n              config: buttotDelete\n\n            }\n          }\n\n        }\n      })\n    })\n\n\n    setDatatable({ ...datatable, rows: tempArrayFindData })\n  }\n\n  const deleteHandle = (e) => {\n    setLoading(true)\n    const leaveId = e.target.name\n    const appoveId = e.target.id\n    refLeave.doc(leaveId).delete()\n    refAppove.doc(appoveId).delete()\n\n\n  }\n\n  \n  return (\n    <div>\n      <Checkuser />\n      <Navbar />\n      <Sidebar />\n      {/* Content Wrapper. Contains page content */}\n      <div className=\"content-wrapper\">\n        {/* Content Header (Page header) */}\n        <div className=\"content-header\">\n          <div className=\"container-fluid\">\n            <div className=\"row mb-2\">\n            </div>{/* /.row */}\n          </div>{/* /.container-fluid */}\n        </div>\n        {/* /.content-header */}\n        {/* Main content */}\n        <div className=\"content\">\n          <div className=\"container-fluid\">\n            <div className=\"row\">\n              <div className=\"col-lg-12\">\n                <div className=\"card\">\n                  <div className=\"card-header \">\n                    <div className=\"d-flex justify-content-between\">\n                      <h3 className=\"m-0 text-dark\" onClick={() => { console.log() }}>รายการขอลา</h3>\n                      <Form />\n                    </div>\n                  </div>\n                  <div className=\"card-body table-responsive \">\n                    {\n                      loading ? (\n                        <div className=\"spinner-border mx-auto\" style={{ width: \"3rem\", height: \"3rem\" }} role=\"status\">\n                        </div>\n\n                      )\n                        : <MDBDataTableV5 data={datatable} entriesOptions={[5, 20, 25]} entries={5} pagesAmount={4} />\n\n                    }\n                  </div>\n                </div>\n              </div>\n              {/* /.col-md-6 */}\n              {/* /.col-md-6 */}\n            </div>\n            {/* /.row */}\n          </div>\n          {/* /.container-fluid */}\n        </div>\n        {/* /.content */}\n      </div>\n      {/* /.content-wrapper */}\n      {/* Control Sidebar */}\n      <aside className=\"control-sidebar control-sidebar-dark\">\n        {/* Control sidebar content goes here */}\n      </aside>\n      {/* /.control-sidebar */}\n      <Footer />\n      {/* <div className=\"modal fade\" id=\"exampleModal\" tabIndex={-1} aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n        <div className=\"modal-dialog\">\n          <div className=\"modal-content\">\n            <div className=\"modal-header\">\n              <h5 className=\"modal-title\" id=\"exampleModalLabel\">แก้ไขการลา</h5>\n              <button type=\"button\" className=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                <span aria-hidden=\"true\">×</span>\n              </button>\n            </div>\n            <div className=\"modal-body\">\n                            <div className=\"container-fluid\">\n                                <div className=\"row\">\n                                    <div className=\"col-md-6\">\n                                        <label>วันที่ลา</label>\n                                        <input type=\"date\" id=\"myDate\"   className=\"form-control\" />\n                                    </div>\n                                    <div className=\"col-md-6\">\n                                        <label htmlFor=\"\">จำนวนการลา</label>\n                                        <input id=\"myAmount\"   type=\"number\" className=\"form-control\" />\n\n                                    </div>\n                                </div>\n                                <div className=\"row\">\n                                    <div className=\"col-md-12\">\n                                        <div className=\"form-group\">\n                                            <label htmlFor=\"\" >เหตุผล</label>\n                                            <textarea id=\"myReson\" className=\"form-control\"></textarea>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n            <div className=\"modal-footer\">\n              <button type=\"button\" className=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n              <button type=\"button\" className=\"btn btn-primary\">Save changes</button>\n            </div>\n          </div>\n        </div>\n      </div> */}\n\n    </div >\n  );\n};\n\nexport default Userleave;"]},"metadata":{},"sourceType":"module"}