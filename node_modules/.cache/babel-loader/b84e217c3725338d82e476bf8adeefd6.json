{"ast":null,"code":"var _jsxFileName = \"/Users/chanaphatsuzuki/Desktop/programming/abzolute/src/page/admin/Leavelist/Leavelist.js\";\nimport React, { useState, useEffect } from 'react';\nimport { firestore, auth } from '../../../firebase/config';\nimport axios from 'axios';\nexport default function Leavelist(props) {\n  const [appove, setAppove] = useState([]);\n  const [leave, setLeave] = useState([]);\n  const [user, setUser] = useState([]);\n  const [typeLeave, setTypeLeave] = useState([]);\n  const refLeave = firestore.collection(\"leave\");\n  const refUser = firestore.collection(\"user\");\n  const refTypeLeave = firestore.collection(\"type_leave\");\n  const refAppove = firestore.collection(\"appove\");\n  const [reson, setReson] = useState(\" \"); //reson_notAllowed\n\n  const userr = firestore.collection(\"user\");\n  useEffect(() => {\n    setAppove(props.data);\n\n    if (props.data.status === \"\") {\n      setAppove({ ...props.data,\n        status: \"รออนุมัติ\"\n      });\n\n      if (props.data.hr_appove !== '') {\n        setAppove({ ...props.data,\n          status: \"รอหัวหน้าอนุมัติ\"\n        });\n      }\n\n      if (props.data.leave_appove !== '') {\n        setAppove({ ...props.data,\n          status: \"รอhrอนุมัติ\"\n        });\n      }\n    }\n\n    refLeave.onSnapshot(doc => {\n      //ดึงLeave ทั้งหมด\n      let tempArrayLeave = [];\n      doc.forEach(data => {\n        tempArrayLeave = [...tempArrayLeave, {\n          amount: data.data().amount,\n          leave_date: data.data().leave_date,\n          leave_start: data.data().leave_start,\n          reson: data.data().reson,\n          type_leave_id: data.data().type_leave_id,\n          uid: data.id,\n          //ไอดีของ leave\n          user_id: data.data().uid // ไอดีของ user\n\n        }];\n      });\n      setLeave(tempArrayLeave);\n    });\n    refUser.onSnapshot(doc => {\n      // ดึงยูเซอร์ทั้งหมด\n      let tempArrayUser = [];\n      doc.forEach(data => {\n        tempArrayUser = [...tempArrayUser, {\n          email: data.data().email,\n          fname: data.data().fname,\n          lname: data.data().lname,\n          name: data.data().name,\n          phone: data.data().phone,\n          uid: data.id,\n          user_group: data.data().user_group\n        }];\n      });\n      setUser(tempArrayUser);\n    });\n    refTypeLeave.onSnapshot(doc => {\n      //ดึง TypeLeave ทั้งหมด\n      let tempArrayTypeLeave = [];\n      doc.forEach(data => {\n        tempArrayTypeLeave = [...tempArrayTypeLeave, {\n          type_leave_name: data.data().type_leave_name,\n          id: data.id\n        }];\n      });\n      setTypeLeave(tempArrayTypeLeave);\n    }); ///////////ทำต่อตรงนี้\n\n    return () => {};\n  }, [props.data]);\n  var appoveLeave = leave.filter(data => data.uid === appove.leave_id);\n  var appoveLeave_typeLeavejoin = appoveLeave.map(data => {\n    return data.type_leave_id;\n  });\n  var typeLeaveJoin = typeLeave.find(data => {\n    return data.id === appoveLeave_typeLeavejoin.toString();\n  });\n  var testt = [{ ...typeLeaveJoin\n  }]; //หาค่ายูเซอร์\n\n  const findUser = appoveLeave.map(data => {\n    return data.user_id;\n  });\n  const userValue = user.find(data => data.uid === findUser.toString());\n  const userValueShow = [{ ...userValue\n  }];\n\n  const notAllowed = (obj, reson, fname, lname, namee) => {\n    const name = fname + \" \" + lname + \" (\" + namee + \") \";\n    userr.doc(auth.currentUser.uid).onSnapshot(doc_user => {\n      if (doc_user.data().user_group === 'hr') {\n        refAppove.doc(obj.id_appove).set({ ...obj,\n          hr_appove: \"ไม่อนุมัติ\",\n          status: \"no\",\n          hr_remark: reson\n        });\n      } else if (doc_user.data().user_group === 'admin') {\n        refAppove.doc(obj.id_appove).set({ ...obj,\n          leave_appove: \"ไม่อนุมัติ\",\n          status: \"no\",\n          leave_remark: reson\n        });\n      }\n\n      axios.get(\"http://localhost:4000/allow/notallowed/\" + reson + \"/\" + name).then(() => {}).catch(err => console.log(err));\n    });\n  };\n\n  const allow = (obj, userValueShow) => {\n    const name = userValueShow[0].fname + \" \" + userValueShow[0].lname + \" (\" + userValueShow[0].name + \")\";\n    const reson = appoveLeave[0].reson;\n    userr.doc(auth.currentUser.uid).onSnapshot(doc_user => {\n      if (doc_user.data().user_group === 'hr') {\n        refAppove.doc(obj.id_appove).set({ ...obj,\n          hr_appove: \"อนุมัติ\"\n        });\n\n        if (obj.leave_appove === 'อนุมัติ') {\n          refAppove.doc(obj.id_appove).set({ ...obj,\n            status: \"y\"\n          });\n          axios.get(\"http://localhost:4000/allow/allow/\" + reson + \"/\" + name).then(res => {\n            console.log(res);\n          }).catch(err => console.log(err));\n        }\n      } else if (doc_user.data().user_group === 'admin') {\n        refAppove.doc(obj.id_appove).set({ ...obj,\n          leave_appove: \"อนุมัติ\"\n        });\n\n        if (obj.hr_appove === 'อนุมัติ') {\n          refAppove.doc(obj.id_appove).set({ ...obj,\n            status: \"y\"\n          });\n          axios.get(\"http://localhost:4000/allow/allow/\" + reson + \"/\" + name).then(res => {\n            console.log(res);\n          }).catch(err => console.log(err));\n        }\n      }\n    });\n  };\n\n  return props.data.status === 'no' || props.data.status === 'y' ? null : /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"th\", {\n    onClick: () => {\n      console.log(appoveLeave);\n    },\n    scope: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 17\n    }\n  }, userValueShow.map((data, index) => /*#__PURE__*/React.createElement(\"div\", {\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 57\n    }\n  }, data.fname, \" \", data.lname, \" (\", data.name, \")\", /*#__PURE__*/React.createElement(\"div\", {\n    className: \"modal fade\",\n    id: \"staticBackdrop\",\n    \"data-backdrop\": \"static\",\n    \"data-keyboard\": \"false\",\n    tabIndex: \"-1\",\n    \"aria-labelledby\": \"staticBackdropLabel\",\n    \"aria-hidden\": \"true\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"modal-dialog\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"modal-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"modal-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(\"h5\", {\n    className: \"modal-title\",\n    id: \"staticBackdropLabel\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 37\n    }\n  }, \"\\u0E2B\\u0E21\\u0E32\\u0E22\\u0E40\\u0E2B\\u0E15\\u0E38\"), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    className: \"close\",\n    \"data-dismiss\": \"modal\",\n    \"aria-label\": \"Close\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    \"aria-hidden\": \"true\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 41\n    }\n  }, \"\\xD7\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"modal-body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    className: \"form-control\",\n    value: reson,\n    onChange: e => {\n      setReson(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 37\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"modal-footer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    className: \"btn btn-secondary\",\n    \"data-dismiss\": \"modal\",\n    onClick: () => setReson(\"\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 37\n    }\n  }, \"\\u0E22\\u0E01\\u0E40\\u0E25\\u0E34\\u0E01\"), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    className: \"btn btn-primary\",\n    \"data-dismiss\": \"modal\",\n    onClick: () => {\n      notAllowed(props.data, reson, data.fname, data.lname, data.name);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 37\n    }\n  }, \"\\u0E15\\u0E01\\u0E25\\u0E07\")))))))), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 17\n    }\n  }, userValueShow.map((data, index) => /*#__PURE__*/React.createElement(\"div\", {\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"far fa-envelope nav-icon\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 33\n    }\n  }), data.email, /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 89\n    }\n  }), /*#__PURE__*/React.createElement(\"i\", {\n    className: \"fas fa-phone-alt\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 33\n    }\n  }), data.phone))), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 17\n    }\n  }, appoveLeave.map((data, index) => /*#__PURE__*/React.createElement(\"div\", {\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 56\n    }\n  }, data.leave_start))), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 17\n    }\n  }, appoveLeave.map((data, index) => /*#__PURE__*/React.createElement(\"div\", {\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 56\n    }\n  }, data.amount))), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 17\n    }\n  }, testt.map((data, index) => /*#__PURE__*/React.createElement(\"div\", {\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 49\n    }\n  }, data.type_leave_name))), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 17\n    }\n  }, appoveLeave.map((data, index) => /*#__PURE__*/React.createElement(\"div\", {\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 56\n    }\n  }, data.reson))), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"badge badge-pill badge-dark\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 21\n    }\n  }, appove.status)), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn btn-sm btn-outline-success mr-1\",\n    onClick: () => {\n      allow(props.data, userValueShow);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 21\n    }\n  }, \"\\u0E2D\\u0E19\\u0E38\\u0E21\\u0E31\\u0E15\\u0E34\"), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"button\",\n    className: \"btn btn-sm btn-outline-danger\",\n    \"data-toggle\": \"modal\",\n    \"data-target\": \"#staticBackdrop\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 21\n    }\n  }, \"\\u0E44\\u0E21\\u0E48\\u0E2D\\u0E19\\u0E38\\u0E21\\u0E31\\u0E15\\u0E34\")));\n}","map":{"version":3,"sources":["/Users/chanaphatsuzuki/Desktop/programming/abzolute/src/page/admin/Leavelist/Leavelist.js"],"names":["React","useState","useEffect","firestore","auth","axios","Leavelist","props","appove","setAppove","leave","setLeave","user","setUser","typeLeave","setTypeLeave","refLeave","collection","refUser","refTypeLeave","refAppove","reson","setReson","userr","data","status","hr_appove","leave_appove","onSnapshot","doc","tempArrayLeave","forEach","amount","leave_date","leave_start","type_leave_id","uid","id","user_id","tempArrayUser","email","fname","lname","name","phone","user_group","tempArrayTypeLeave","type_leave_name","appoveLeave","filter","leave_id","appoveLeave_typeLeavejoin","map","typeLeaveJoin","find","toString","testt","findUser","userValue","userValueShow","notAllowed","obj","namee","currentUser","doc_user","id_appove","set","hr_remark","leave_remark","get","then","catch","err","console","log","allow","res","index","e","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { firestore, auth } from '../../../firebase/config'\nimport axios from 'axios'\nexport default function Leavelist(props) {\n    const [appove, setAppove] = useState([])\n    const [leave, setLeave] = useState([])\n    const [user, setUser] = useState([])\n    const [typeLeave, setTypeLeave] = useState([])\n    const refLeave = firestore.collection(\"leave\")\n    const refUser = firestore.collection(\"user\")\n    const refTypeLeave = firestore.collection(\"type_leave\")\n    const refAppove = firestore.collection(\"appove\")\n    const [reson, setReson] = useState(\" \") //reson_notAllowed\n    const userr = firestore.collection(\"user\")\n\n    useEffect(() => {\n        setAppove(props.data)\n        if (props.data.status === \"\") {\n            setAppove({ ...props.data, status: \"รออนุมัติ\" })\n            if (props.data.hr_appove !== '') {\n                setAppove({ ...props.data, status: \"รอหัวหน้าอนุมัติ\" })\n            }\n            if (props.data.leave_appove !== '') {\n                setAppove({ ...props.data, status: \"รอhrอนุมัติ\" })\n            }\n        }\n        refLeave.onSnapshot(doc => { //ดึงLeave ทั้งหมด\n            let tempArrayLeave = []\n            doc.forEach(data => {\n                tempArrayLeave = [\n                    ...tempArrayLeave,\n                    {\n                        amount: data.data().amount,\n                        leave_date: data.data().leave_date,\n                        leave_start: data.data().leave_start,\n                        reson: data.data().reson,\n                        type_leave_id: data.data().type_leave_id,\n                        uid: data.id,   //ไอดีของ leave\n                        user_id: data.data().uid // ไอดีของ user\n                    }\n                ]\n            })\n            setLeave(tempArrayLeave)\n        })\n\n        refUser.onSnapshot(doc => { // ดึงยูเซอร์ทั้งหมด\n            let tempArrayUser = []\n            doc.forEach(data => {\n                tempArrayUser = [\n                    ...tempArrayUser,\n                    {\n                        email: data.data().email,\n                        fname: data.data().fname,\n                        lname: data.data().lname,\n                        name: data.data().name,\n                        phone: data.data().phone,\n                        uid: data.id,\n                        user_group: data.data().user_group\n                    }\n                ]\n            })\n            setUser(tempArrayUser)\n        })\n\n        refTypeLeave.onSnapshot(doc => { //ดึง TypeLeave ทั้งหมด\n            let tempArrayTypeLeave = []\n            doc.forEach(data => {\n                tempArrayTypeLeave = [\n                    ...tempArrayTypeLeave,\n                    {\n                        type_leave_name: data.data().type_leave_name,\n                        id: data.id\n                    }\n                ]\n            })\n            setTypeLeave(tempArrayTypeLeave)\n        })\n        ///////////ทำต่อตรงนี้\n\n        return () => {\n\n        }\n    }, [props.data])\n\n    var appoveLeave = leave.filter(data => (data.uid === appove.leave_id))\n    var appoveLeave_typeLeavejoin = appoveLeave.map(data => {\n        return data.type_leave_id\n    })\n    var typeLeaveJoin = typeLeave.find(data => {\n        return data.id === appoveLeave_typeLeavejoin.toString()\n    })\n    var testt = [{ ...typeLeaveJoin }]\n\n\n    //หาค่ายูเซอร์\n    const findUser = appoveLeave.map((data => {\n        return data.user_id\n    }))\n    const userValue = user.find(data => (data.uid === findUser.toString()))\n\n    const userValueShow = [{ ...userValue }]\n\n\n\n\n    const notAllowed = (obj, reson,fname,lname,namee) => {\n        const name = fname+\" \"+lname+ \" (\"+namee+\") \"\n        userr.doc(auth.currentUser.uid).onSnapshot(doc_user => {\n              if (doc_user.data().user_group === 'hr') {\n                refAppove.doc(obj.id_appove).set({ ...obj, hr_appove: \"ไม่อนุมัติ\", status: \"no\",hr_remark:reson })\n              } else if (doc_user.data().user_group === 'admin') {\n                refAppove.doc(obj.id_appove).set({ ...obj, leave_appove: \"ไม่อนุมัติ\", status: \"no\",leave_remark:reson })\n              }\n            axios.get(\"http://localhost:4000/allow/notallowed/\"+reson+\"/\"+name)\n                .then(() => {\n                }).catch(err => console.log(err))\n        })\n\n    }\n\n\n    const allow = (obj,userValueShow) => {\n        const name = userValueShow[0].fname+\" \"+userValueShow[0].lname +\" (\"+userValueShow[0].name+\")\"\n        const reson = appoveLeave[0].reson\n        userr.doc(auth.currentUser.uid).onSnapshot(doc_user => {\n          if (doc_user.data().user_group === 'hr') {\n            refAppove.doc(obj.id_appove).set({ ...obj, hr_appove: \"อนุมัติ\" })\n            if (obj.leave_appove === 'อนุมัติ') {\n              refAppove.doc(obj.id_appove).set({ ...obj, status: \"y\" })\n              axios.get(\"http://localhost:4000/allow/allow/\"+reson+\"/\"+name)\n                .then((res) => {\n                  console.log(res)\n                }).catch(err => console.log(err))\n            }\n          } else if (doc_user.data().user_group === 'admin') {\n            refAppove.doc(obj.id_appove).set({ ...obj, leave_appove: \"อนุมัติ\" })\n            if (obj.hr_appove === 'อนุมัติ') {\n              refAppove.doc(obj.id_appove).set({ ...obj, status: \"y\" })\n              axios.get(\"http://localhost:4000/allow/allow/\"+reson+\"/\"+name)\n                .then((res) => {\n                  console.log(res)\n                }).catch(err => console.log(err))\n            }\n          }\n        })\n    \n    \n      }\n    return (\n        props.data.status === 'no' || props.data.status === 'y' ? (\n            null\n        ) : <tr>\n                <th onClick={()=>{console.log(appoveLeave)}} scope=\"row\">{\n                    userValueShow.map((data, index) => (<div key={index}>{data.fname} {data.lname} ({data.name})               \n                    <div className=\"modal fade\" id=\"staticBackdrop\" data-backdrop=\"static\" data-keyboard=\"false\" tabIndex=\"-1\" aria-labelledby=\"staticBackdropLabel\" aria-hidden=\"true\">\n                        <div className=\"modal-dialog\">\n                            <div className=\"modal-content\">\n                                <div className=\"modal-header\">\n                                    <h5 className=\"modal-title\" id=\"staticBackdropLabel\">หมายเหตุ</h5>\n                                    <button type=\"button\" className=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                                        <span aria-hidden=\"true\">&times;</span>\n                                    </button>\n                                </div>\n                                <div className=\"modal-body\">\n                                    <input className=\"form-control\" value={reson} onChange={(e) => { setReson(e.target.value) }} />\n                                </div>\n                                <div className=\"modal-footer\">\n                                    <button type=\"button\" className=\"btn btn-secondary\" data-dismiss=\"modal\" onClick={() => setReson(\"\")}>ยกเลิก</button>\n                                    <button type=\"button\" className=\"btn btn-primary\" data-dismiss=\"modal\" onClick={() => { notAllowed(props.data, reson,data.fname,data.lname,data.name) }}>ตกลง</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div></div>\n                    ))}</th>\n                <td>\n                    {\n                        userValueShow.map((data, index) => (\n                            <div key={index}>\n                                <i className=\"far fa-envelope nav-icon\"></i>{data.email}<br></br>\n                                <i className=\"fas fa-phone-alt\"></i>{data.phone}\n                            </div>\n                        ))\n                    }\n                </td>\n                <td></td>\n                <td>{appoveLeave.map((data, index) => (<div key={index}>{data.leave_start}</div>))}</td>\n                <td>{appoveLeave.map((data, index) => (<div key={index}>{data.amount}</div>))}</td>\n                <td>{testt.map((data, index) => <div key={index}>{data.type_leave_name}</div>)}</td>\n                <td>{appoveLeave.map((data, index) => (<div key={index}>{data.reson}</div>))}</td>\n                <td>\n                    <span className=\"badge badge-pill badge-dark\">{appove.status}</span>\n                </td>\n                <td>\n                    <button className=\"btn btn-sm btn-outline-success mr-1\" onClick={()=>{allow(props.data,userValueShow)}}>อนุมัติ</button>\n                    {/* <button className=\"btn btn-sm btn-outline-danger\" onClick={props.notAllowed} >ไม่อนุมัติ</button> */}\n                    <button type=\"button\" className=\"btn btn-sm btn-outline-danger\" data-toggle=\"modal\" data-target=\"#staticBackdrop\">\n                        ไม่อนุมัติ\n                    </button>\n                </td>\n\n\n            </tr>\n\n    )\n}\n"]},"metadata":{},"sourceType":"module"}