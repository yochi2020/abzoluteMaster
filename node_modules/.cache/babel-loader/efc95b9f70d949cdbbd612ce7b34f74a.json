{"ast":null,"code":"var _jsxFileName = \"/Users/chanaphatsuzuki/Desktop/programming/abzolute/src/page/admin/Employee.js\";\nimport React, { useEffect, useState } from 'react';\nimport Footer from '../../component/admin/Footer';\nimport Navbar from '../../component/admin/Navbar';\nimport Sidebar from '../../component/admin/Sidebar';\nimport Checkadmin from './Checkadmin';\nimport Form from './Employee/Form';\nimport Userlist from './Employee/Employee';\nimport { firestore } from '../../firebase/config';\nimport axios from 'axios';\nimport $ from 'jquery';\nimport { MDBDataTableV5 } from 'mdbreact';\n\nfunction Employee() {\n  const ref = firestore.collection(\"user\");\n  const [user, setUser] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [datatable, setDatatable] = useState({\n    columns: [{\n      label: 'ชื่อพนักงาน',\n      field: 'name',\n      width: 200,\n      attributes: {\n        'aria-controls': 'DataTable',\n        'aria-label': 'Name'\n      }\n    }, {\n      label: 'อีเมล',\n      field: 'email',\n      width: 200\n    }, {\n      label: 'เบอร์โทร',\n      field: 'phone',\n      width: 200\n    }, {\n      label: 'แก้ไข',\n      field: 'edit',\n      sort: 'asc',\n      width: 5\n    }, {\n      label: 'ลบ',\n      field: 'delete',\n      sort: 'asc',\n      width: 5\n    }]\n  });\n  useEffect(() => {\n    const unsubscribe = ref.onSnapshot(snapshot => {\n      let tempDataArray = [];\n      snapshot.forEach(doc => {\n        tempDataArray = [...tempDataArray, {\n          name: doc.data().fname + doc.data().lname + \" \" + \"(\" + doc.data().name + \")\",\n          email: doc.data().email,\n          phone: doc.data().phone,\n          uid: doc.id,\n          user_group: doc.data().user_group,\n          edit: /*#__PURE__*/React.createElement(\"button\", {\n            className: \"btn btn-sm btn-outline-success \",\n            onClick: () => {\n              editHandle(doc.data());\n            },\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 69,\n              columnNumber: 18\n            }\n          }, \"\\u0E41\\u0E01\\u0E49\\u0E44\\u0E02\"),\n          delete: /*#__PURE__*/React.createElement(\"button\", {\n            className: \"btn btn-sm btn-outline-danger\",\n            onClick: () => {\n              deleteHandle(doc.id);\n            },\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 70,\n              columnNumber: 20\n            }\n          }, \"\\u0E25\\u0E1A\")\n        }];\n      });\n      setUser(() => tempDataArray);\n      setLoading(false);\n      setDatatable({ ...datatable,\n        rows: user\n      });\n    });\n    return () => {};\n  }, [user]);\n\n  const deleteHandle = async uid => {\n    let obj = {\n      uid\n    };\n    var leaveId = ''; //delete leave of uerr\n\n    await firestore.collection('leave').where('uid', '==', obj.uid).onSnapshot(doc => {\n      doc.forEach(data => {\n        firestore.collection(\"leave\").doc(data.id).delete();\n        leaveId = data.id;\n        firestore.collection(\"appove\").where('leave_id', '==', data.id).onSnapshot(doc => {\n          doc.forEach(d => {\n            firestore.collection(\"appove\").doc(d.id).delete();\n          });\n        });\n      });\n      console.log(leaveId);\n    }); // delete quota of user\n\n    await firestore.collection(\"quota\").where('uid', '==', obj.uid).onSnapshot(doc => {\n      doc.forEach(data => {\n        console.log(data.data());\n        firestore.collection(\"quota\").doc(data.id).delete();\n      });\n    }); // delete user\n\n    await axios.post(\"http://localhost:4000/deleteuser\", obj).then(uid => {\n      const refUser = firestore.collection(\"user\").doc(uid.data);\n      refUser.delete();\n    });\n  };\n\n  const [editQuota, setEditQuota] = useState([]);\n  const [editUser, setEditUser] = useState([]);\n\n  const editHandle = data => {\n    setEditQuota([]);\n    firestore.collection(\"quota\").where('uid', '==', data.uid).onSnapshot(doc => {\n      let tempArrayquota = [];\n      doc.forEach(data => {\n        tempArrayquota = [...tempArrayquota, {\n          amount: data.data().amount,\n          type_leave_id: data.data().type_leave_id,\n          uid: data.data().uid\n        }];\n      });\n      setEditQuota(tempArrayquota);\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Checkadmin, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Navbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Sidebar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-lg-12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-header \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex justify-content-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    className: \"m-0 text-dark\",\n    onClick: () => {\n      console.log(editQuota);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 23\n    }\n  }, \"\\u0E1E\\u0E19\\u0E31\\u0E01\\u0E07\\u0E32\\u0E19\"), /*#__PURE__*/React.createElement(Form, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 23\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"card-body table-responsive \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(MDBDataTableV5, {\n    hover: true,\n    entriesOptions: [5, 20, 25],\n    entries: 5,\n    pagesAmount: 4,\n    data: datatable,\n    searchTop: true,\n    searchBottom: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 19\n    }\n  }), loading ? /*#__PURE__*/React.createElement(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 31\n    }\n  }), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 31\n    }\n  }), /*#__PURE__*/React.createElement(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 31\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"spinner-border mx-auto mr-4\",\n    style: {\n      width: \"3rem\",\n      height: \"3rem\"\n    },\n    role: \"status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 35\n    }\n  }))) : null))))))), /*#__PURE__*/React.createElement(\"aside\", {\n    className: \"control-sidebar control-sidebar-dark\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 7\n    }\n  }));\n}\n\nexport default Employee;","map":{"version":3,"sources":["/Users/chanaphatsuzuki/Desktop/programming/abzolute/src/page/admin/Employee.js"],"names":["React","useEffect","useState","Footer","Navbar","Sidebar","Checkadmin","Form","Userlist","firestore","axios","$","MDBDataTableV5","Employee","ref","collection","user","setUser","loading","setLoading","datatable","setDatatable","columns","label","field","width","attributes","sort","unsubscribe","onSnapshot","snapshot","tempDataArray","forEach","doc","name","data","fname","lname","email","phone","uid","id","user_group","edit","editHandle","delete","deleteHandle","rows","obj","leaveId","where","d","console","log","post","then","refUser","editQuota","setEditQuota","editUser","setEditUser","tempArrayquota","amount","type_leave_id","height"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport Footer from '../../component/admin/Footer';\nimport Navbar from '../../component/admin/Navbar';\nimport Sidebar from '../../component/admin/Sidebar';\nimport Checkadmin from './Checkadmin';\nimport Form from './Employee/Form';\nimport Userlist from './Employee/Employee'\nimport { firestore } from '../../firebase/config'\nimport axios from 'axios'\nimport $  from 'jquery'\nimport { MDBDataTableV5 } from 'mdbreact';\n\nfunction Employee() {\n  const ref = firestore.collection(\"user\");\n  const [user, setUser] = useState([])\n  const [loading, setLoading] = useState(true)\n  \n  const [datatable, setDatatable] = useState({\n    columns: [\n      {\n        label: 'ชื่อพนักงาน',\n        field: 'name',\n        width: 200,\n        attributes: {\n          'aria-controls': 'DataTable',\n          'aria-label': 'Name',\n        },\n      },\n      {\n        label: 'อีเมล',\n        field: 'email',\n        width: 200,\n      },\n      {\n        label: 'เบอร์โทร',\n        field: 'phone',\n        width: 200,\n      },\n      {\n        label: 'แก้ไข',\n        field: 'edit',\n        sort: 'asc',\n        width: 5,\n      },\n      {\n        label: 'ลบ',\n        field: 'delete',\n        sort: 'asc',\n        width: 5,\n      }\n    ],\n    \n  });\n    \n  useEffect(() => {\n\n    \n    const unsubscribe = ref.onSnapshot(snapshot => {\n      let tempDataArray = [];\n      snapshot.forEach(doc => {\n        tempDataArray = [\n          ...tempDataArray,\n          {\n            name: doc.data().fname + doc.data().lname+\" \" +\"(\"+ doc.data().name+\")\",\n            email: doc.data().email,\n            phone:doc.data().phone,\n            uid: doc.id,\n            user_group: doc.data().user_group,\n            edit:<button  className=\"btn btn-sm btn-outline-success \" onClick={()=>{editHandle(doc.data())}}>แก้ไข</button>,\n            delete:<button  className=\"btn btn-sm btn-outline-danger\" onClick={()=>{deleteHandle(doc.id)}}>ลบ</button> \n          }\n        ];\n      })\n      setUser(()=>tempDataArray)\n      setLoading(false)\n      setDatatable({...datatable,rows:user})\n    })\n    return () => {\n    };\n  },[user]);\n\n\n  const deleteHandle = async (uid) => {\n    let obj={\n      uid\n    }\n    var leaveId = '';\n    //delete leave of uerr\n    await firestore.collection('leave').where('uid','==',obj.uid)\n    .onSnapshot(doc=>{\n        doc.forEach(data=>{\n          firestore.collection(\"leave\").doc(data.id)\n          .delete()\n          leaveId=data.id\n          firestore.collection(\"appove\").where('leave_id','==',data.id)\n          .onSnapshot(doc=>{\n            doc.forEach(d=>{\n              firestore.collection(\"appove\").doc(d.id)\n              .delete()\n            })\n          })\n          \n        })\n        console.log(leaveId)\n    })\n    // delete quota of user\n     await firestore.collection(\"quota\").where('uid','==',obj.uid)\n    .onSnapshot(doc=>{\n      doc.forEach(data=>{\n        console.log(data.data())\n        firestore.collection(\"quota\").doc(data.id)\n        .delete()\n      })\n    })\n\n    \n    // delete user\n    await axios.post(\"http://localhost:4000/deleteuser\",obj)\n    .then( (uid)=>{\n      const refUser = firestore.collection(\"user\").doc(uid.data)\n       refUser.delete()\n    })\n  }\n\n  const [editQuota,setEditQuota]=useState([])\n  const [editUser,setEditUser]=useState([])\n  const editHandle = (data)=>{\n    setEditQuota([])\n    firestore.collection(\"quota\").where('uid','==',data.uid)\n    .onSnapshot(doc=>{\n      let tempArrayquota =[]\n      doc.forEach(data=>{\n        tempArrayquota=[\n          ...tempArrayquota,\n          {\n            amount:data.data().amount,\n            type_leave_id:data.data().type_leave_id,\n            uid:data.data().uid\n          }\n        ]\n      })\n      setEditQuota(tempArrayquota)\n    })\n    \n  }\n  return (\n    <div>\n      <Checkadmin />\n      <Navbar />\n      <Sidebar />\n      {/* Content Wrapper. Contains page content */}\n      <div className=\"content-wrapper\">\n        {/* Content Header (Page header) */}\n        <div className=\"content-header\">\n          <div className=\"container-fluid\">\n            <div className=\"row mb-2\">\n            </div>{/* /.row */}\n          </div>{/* /.container-fluid */}\n        </div>\n        {/* /.content-header */}\n        {/* Main content */}\n        <div className=\"content\">\n          <div className=\"container-fluid\">\n            <div className=\"row\">\n              <div className=\"col-lg-12\">\n                <div className=\"card\">\n                  <div className=\"card-header \">\n                    <div className=\"d-flex justify-content-between\">\n                      <h3 className=\"m-0 text-dark\" onClick={()=>{console.log(editQuota)}} >พนักงาน</h3>\n                      <Form />\n                    </div>\n                  </div>\n                  <div className=\"card-body table-responsive \">\n                  <MDBDataTableV5 hover entriesOptions={[5, 20, 25]}  entries={5} pagesAmount={4} data={datatable} searchTop searchBottom={false}/>\n                   \n                        {\n                          loading ? (\n                            <tr>\n                              <td></td>\n                              <td></td>\n                              <td><div className=\"spinner-border mx-auto mr-4\" style={{width:\"3rem\",height:\"3rem\"}} role=\"status\">\n                              </div></td>\n                            </tr>\n                          ) : null\n                        }\n                  </div>\n                </div>\n              </div>\n              {/* /.col-md-6 */}\n              {/* /.col-md-6 */}\n            </div>\n            {/* /.row */}\n          </div>\n          {/* /.container-fluid */}\n        </div>\n        {/* /.content */}\n      </div>\n      {/* /.content-wrapper */}\n      {/* Control Sidebar */}\n      <aside className=\"control-sidebar control-sidebar-dark\">\n        {/* Control sidebar content goes here */}\n      </aside>\n      {/* /.control-sidebar */}\n      <Footer />\n    </div>\n  );\n}\n\nexport default Employee;\n"]},"metadata":{},"sourceType":"module"}